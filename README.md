# mAuth

Сервис авторизации/регистрации пользователей.

## Запуск приложения

Перед запуском приложения необходимо откорректировать конфигурацию модуля в файле `./config.js`. Также, возможно понадобиться создать базу данных (см. описание скриптов ниже).

>Прим.: в конфигурационном файле есть переменная `node.env`, которая по умолчанию имеет значение `dev`. Этот параметр конфигурации разрешает обращение к серверу из любого источника игнорируя CORS. Если установить любое другой значение этой переменной, отличное от `dev`, то контроль источника запросов будет включён, а также запуск тестов будет не возможен.

Для запуска приложения выполнить:
```bash
node index
```

Для создания базы данных выполнить:
```bash
npm run db:init
```

Для удаления базы данных выполнить:
```bash
npm run db:drop
```

Для запуска тестов:
```bash
npm test
```

Для запуска линтера:
```bash
npm run lint
```

Для запуска линтер в режиме исправления ошибок:
```bash
npm run lint:fix
```

## Запуск приложения с использованием Docker

Перед запуском приложения необходимо откорректировать переменные окружения для образа в файле `docker-compose.yml`. Для запуска приложения выполнить:

```bash
docker compose up -d
```

## Описание API

При успешной авторизации пользователя, сервис возвращает 2 токена:
- access токен доступа (короткоживущий JWT-токен);
- refresh токен.

Клиент при обращении к сервису по маршрутам, требующим какого-либо токена, должен передавать токен в заголовке 'Authorisation'. Пример:
```
headers: {
  'Authorisation': 'Bearer eff2d485-8669-4d6b-8d6c-22ddc6d0af6c'
}
```

### Регистрация пользователя

Маршрут:
```
POST /api/mauth/signup
```

### Авторизация пользователя

Маршрут:
```
POST /api/mauth/signin
```

### Удаление сессии

Маршрут:
```
DELETE /api/mauth/signout
```

### Подтверждение email

Маршрут:
```
GET /api/mauth/confirm/:token
```
где `:token` - токен подтверждения

### Проверка существования сессии

Маршрут:
```
GET /api/mauth/access
```

### Перевыпуск токена доступа

Маршрут:
```
GET /api/mauth/access
```

### Запрос на изменение пароля

Маршрут:
```
PATCH /api/mauth/forgot
```

### Подтверждение изменения пароля

Маршрут:
```
GET /api/mauth/forgot/:token
```
где `:token` - токен подтверждения

### Изменение пароля

Маршрут:
```
PATCH /api/mauth/password
```